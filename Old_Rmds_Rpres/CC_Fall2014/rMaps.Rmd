rMaps
=====

rMaps is an R package to create, customize and publish interactive maps from R. It supports multiple mapping libraries, including leaflet, datamaps and crosslet

You can install rMaps from github using the devtools package. You will also need to install the dev version of rCharts, that contains several experimental features, required by rMaps.

```{r}
install.packages("base64enc")
library(devtools)
install_github('ramnathv/rCharts@dev')
install_github('ramnathv/rMaps')
```

Quick Start
-----------
CrossLet is an amazing mappling library that combines Leaflet and CrossFilter, allowing one to create awesome visualizations. rMaps wraps CrossLet and provides R users with a simple interface to access its features.

```{r}
library(rMaps)
crosslet(
  x = "country", 
  y = c("web_index", "universal_access", "impact_empowerment", "freedom_openness"),
  data = web_index
)
```

DataMaps uses D3.js to create customizable SVG map visualizations in a single Javscript file. rMaps provides a simple wrapper around DataMaps and also extends its features using AngularJS.

```{r}
ichoropleth(Crime ~ State, data = subset(violent_crime, Year == 2010))
ichoropleth(Crime ~ State, data = violent_crime, animate = "Year")
ichoropleth(Crime ~ State, data = violent_crime, animate = "Year", play = TRUE)

d1 = ichoropleth(Crime ~ State, data = violent_crime, animate = "Year")
d1$save('rMaps.html', cdn = TRUE)
d1$publish()
```

Tornado data
------------
From the Storm Prediction Center (SPC) http://www.spc.noaa.gov/gis/svrgis/
```{r, eval=FALSE}
download.file("http://www.spc.noaa.gov/gis/svrgis/zipped/tornado.zip",
                    "tornado.zip", mode="wb")
```

Read the tornado data.
```{r}
library(rgdal)
unzip("tornado.zip")
TornL = readOGR(dsn = ".", layer = "tornado", 
                stringsAsFactors = FALSE)
TornL$OM = as.integer(TornL$OM)
TornL$Year = as.integer(TornL$YR)
TornL$Month = as.integer(TornL$MO)
TornL$EF = as.integer(TornL$MAG)
TornL$Date = as.Date(TornL$DATE)
TornL$Length = as.numeric(TornL$LEN) * 1609.34
TornL$Width = as.numeric(TornL$WID) * .9144
TornL$FAT = as.integer(TornL$FAT)
TornL$SLON = as.numeric(TornL$SLON)
TornL$SLAT = as.numeric(TornL$SLAT)
TornL$ELON = as.numeric(TornL$ELON)
TornL$ELAT = as.numeric(TornL$ELAT)
TornL$INJ = as.numeric(TornL$INJ)
TornL$LOSS = as.numeric(TornL$LOSS)
Torn.df = as.data.frame(TornL)
```
```{r}
df = Torn.df %>%
  filter(Year >= 1953) %>%
  group_by(ST) %>%
  summarise(Deaths = sum(FAT),
            Injuries = sum(INJ),
            Loss = sum(LOSS),
            Count = sum(EF >= 0))
```

```{r}
d1 = ichoropleth(Count ~ ST, data = df, 
                 labels = "Number of Tornadoes",
                 pal = "Blues")
d1
d1$save(destfile = 'EF05.html')
```

```{r}
df = Torn.df %>%
  mutate(Year2 = cut(Year, 5)) %>%
  group_by(Year2, ST) %>%
  summarise(Counts = sum(EF >= 0)) %>%
  do(viz = ichoropleth(Counts ~ ST, data = .,
     width = 150, height = 100
  )) %>%
  small_multiples(ncols = 3)
```

```{r plotNumber}
p = ggplot(TorByYS.df[TorByYS.df$ST == "NE", ], 
           aes(x = Year, y = Count, fill = Count)) + 
  theme_bw() + 
  geom_bar(stat='identity') + 
  scale_fill_continuous(low='orange', high='red') +
  geom_text(aes(label = Count), vjust = 1.5, size = 3) +
  scale_x_continuous(breaks = seq(1950, 2013, 10)) +
  ylab("Annual Number of EF1+ Tornadoes in Nebraska") +
  xlab("") +
  theme(axis.text.x  = element_text(size = 11), legend.position = "none")
p
labels.df = data.frame(Year= 2006, Count = 44 , 
                       label = c("Data Source: SPC"))
p + geom_text(data=labels.df, aes(x = Year, y = Count, label = label), 
              hjust = 0, size = 4)
            
```


```{r}
d1 = ichoropleth(Injuries ~ ST, data = TorByYS.df, 
            animate = "Year",
            labels = "Number of Tornadoes",
            pal = "Greens")
d1$save(destfile = 'EF05.html')
```
