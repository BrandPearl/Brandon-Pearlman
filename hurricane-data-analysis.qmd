---
title: "Tropical cyclone data around the world"
format:
  revealjs:
    slide-number: c/t
    code-fold: false
    chalkboard: true
bibliography: References.bib
editor: source
---

## Data on past tropical cyclones

* Where do you find data on past tropical cyclones?
* How do you get the data into a format that you can work with?

##

Atlantic hurricanes from the {hockeystick} package

```{r}
#| echo: true
library(hockeystick)

atlhur <- get_hurricanes()

atlhur |>
  head()
```

##

```{r}
#| echo: true
atlhur |>
  plot_hurricanes()
```

##

```{r}
#| echo: true
atlhur |>
  plot_hurricane_nrg()
```

##

```{r}
#| echo: true
atlhur |>
  plot_hurricane_nrg() +
  ggplot2::geom_smooth(span = .5, col = "green")
```

##

![Map showing the tracks and intensities of all tropical cyclones over the North Atlantic during the 2019 hurricane season](https://www.nhc.noaa.gov/data/tracks/tracks-at-2019.png){#fig-tracks}

##

The National Hurricane Center has data on all tropical cyclones occurring in the North Atlantic and western North Pacific. 

These data are available [here](https://www.nhc.noaa.gov/data/).

## International Best Track Archive for Climate Stewardship (IBTraCS)

Working with the IBTrACS version 4 data set

First you need to

:::{.incremental}
1. Download and unzip the data file
2. Get the data file into R
3. Glimpse contents
:::

:::{.callout-note}
Historical tropical cyclone data from around the world in CSV, netCDF, and shapefiles are available from the International Best-Track Archive for Climate Stewardship. [Here](https://www.ncei.noaa.gov/data/international-best-track-archive-for-climate-stewardship-ibtracs/v04r00/access)
:::

## Download and unzip the data file

IBTraCS as shapefile

```{r}
#| echo: true
l <- "https://www.ncei.noaa.gov/data/international-best-track-archive-for-climate-stewardship-ibtracs/v04r00/access/shapefile/IBTrACS.NA.list.v04r00.lines.zip"
  
if(!"IBTrACS.NA.list.v04r00.lines.zip" %in% list.files(here::here("data"))) {
download.file(url = l,
              destfile = here::here("data",
                                    "IBTrACS.NA.list.v04r00.lines.zip"))
unzip(here::here("data", "IBTrACS.NA.list.v04r00.lines.zip"),
      exdir = here::here("data"))
}
```

## Get the data file into R

```{r}
#| echo: true
TC.sf <- sf::st_read(dsn = here::here("data"), 
                     layer = "IBTrACS.NA.list.v04r00.lines")
```

## Glimpse the contents {.smaller}

```{r}
#| echo: true
TC.sf |>
  dplyr::glimpse()
```

Each row is a separate three-hourly estimate.

## Hurricane Michael (2018)

Hurricane Michael was a very powerful and destructive tropical cyclone that became the first Category 5 hurricane to make landfall in the contiguous United States since Andrew in 1992.[^1]

[^1]: [Read more](https://en.wikipedia.org/wiki/Hurricane_Michael).

##

Here you remove all rows from `TC.sf` except those corresponding to Hurricane Michael in 2018.

```{r}
#| echo: true
One.sf <- TC.sf |>
  dplyr::filter(SEASON >= 2018 & NAME == "MICHAEL") |>
  dplyr::select(NAME, USA_WIND)
```

You've removed all rows from `TC.sf` and all columns except `NAME` and `USA_WIND`.

So the new data `One.sf` contains `r nrow(One.sf)` rows and `r ncol(One.sf)` columns.

##

You overlay the track of Hurricane Michael colored by wind speed onto [Leaflet](https://openmaptiles.org/docs/website/leaflet/) map tiles.

```{r}
#| echo: true
tmap::tmap_mode("view")
tmap::tm_shape(One.sf) +
  tmap::tm_lines(col = "USA_WIND", lwd = 3)
```


## {.smaller}

Import the IBTrACS Atlantic hurricane csv file

```{r, eval=FALSE}
#| echo: true
L <- "https://www.ncei.noaa.gov/data/international-best-track-archive-for-climate-stewardship-ibtracs/v04r00/access/csv/ibtracs.NA.list.v04r00.csv"

NA.df <- readr::read_csv(file = L,
                         show_col_types = FALSE) |>
  dplyr::filter(SEASON != "Year") |>
  dplyr::mutate(Season = as.integer(SEASON)) |>
  dplyr::filter(Season >= 1950) |>
  dplyr::mutate(Time = as.Date(ISO_TIME),
                W_kt = as.numeric(USA_WIND),
                W_mps = W_kt * .5144447) |>
  dplyr::select(SID, Season, BASIN, NAME, Time, W_kt, W_mps)

readr::write_csv(NA.df, 
                 file = here::here("data", "NA.csv"))
```

##

Get wind speed quantiles for tropical cyclones with winds at least 33 m/s. First get per storm fastest wind speed
```{r}
#| echo: true
NA.df <- readr::read_csv(file = here::here("data", "NA.csv"),
                         show_col_types = FALSE)

LMI.df <- NA.df |>
  dplyr::group_by(SID) |>
  dplyr::summarize(Year = dplyr::first(Season),
                   Name = dplyr::first(NAME),
                   MaxW_mps = max(W_mps)) |>
  dplyr::filter(MaxW_mps >= 33)
```

## Frequency

```{r}
Frequency.df <- LMI.df |>
  dplyr::group_by(Year) |>
  dplyr::summarize(nH = dplyr::n())

ggplot(data = Frequency.df,
       mapping = aes(x = Year, y = nH)) +
  geom_line() +
  geom_smooth(method = lm) 
```
##

Increases in the number of hurricanes 

```{r}
#| echo: true
glm(nH ~ Year, data = Frequency.df, family = poisson)
```

Multiply .004 by 100 to get .4 percent per year or 4% per decade.

## Intensity

```{r}
#| echo: true
Intensity.df <- LMI.df |>
  dplyr::group_by(Year) |>
  dplyr::summarize(q90 = quantile(MaxW_mps, probs = .9),
                   q75 = quantile(MaxW_mps, probs = .75),
                   q50 = quantile(MaxW_mps, probs = .5)) |>
  tidyr::pivot_longer(cols = 2:4, names_to = "Level", values_to = "Quantile")


ggplot(data = Intensity.df,
       mapping = aes(x = Year, y = Quantile, color = Level)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) 
```

##

```{r}
#| echo: true
library(ggplot2)

ggplot(data = LMI.df,
       mapping = aes(x = Year, y = MaxW_mps)) +
  geom_point() +
  geom_smooth(method = lm)
```

##

```{r}
#| echo: true

ggplot(data = LMI.df,
       mapping = aes(y = MaxW_mps, x = Year, group = Year)) +
  geom_boxplot()
```

```{r}
#| echo: true

summary(quantreg::rq(MaxW_mps ~ Year, tau = .9, data = LMI.df))

plot(quantreg::rq(MaxW_mps ~ Year, tau = -1, data = LMI.df))
```
